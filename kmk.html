<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kiss Marry Kill</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" href="default.css">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon.png">
    <meta name="apple-mobile-web-app-title" content="Blue Flash">


  <style>
    .celeb-grid{
      display:flex;
      justify-content:center;
      gap:24px;
      margin:30px 0;
      flex-wrap:wrap;
      min-height:300px;
    }

    .drop-zones{
      display:flex;
      justify-content:center;
      gap:24px;
      margin-top:40px;
      flex-wrap:wrap;
    }

    .zone{
      width:220px;
      height:340px;
      border:2px dashed #555;
      border-radius:12px;
      padding:10px;
      background:#1a1a1a;
      display:flex;
      flex-direction:column;
      align-items:center;
      transition:.2s;
    }

    .zone h3{
      margin:5px 0 10px;
    }

    .zone.filled{
      border-color:#3cff9a;
      transform:scale(1.03);
    }

    .in-slot{
      cursor:grab;
      border-color:#3cff9a;
    }

    .in-slot:hover{
      transform:none;
    }
  </style>
</head>

<body>

<div id="helpWrapper">
  <button id="helpBtn">?</button>
  <div id="helpTooltip">
    <strong>How to Play</strong><br><br>
    ‚Ä¢ Each round, you will be shown three people<br>
    ‚Ä¢ Drag each person into Kiss, Marry, or Kill<br>
    ‚Ä¢ Once all slots are filled, the next round begins<br><br>
    <strong>Note</strong><br>
    You can drag a person back to the pool or another slot
  </div>
</div>

<h1>Kiss Marry Kill</h1>

<div class="navLinks"></div>
<br><br>

<div class="mode-toggle">
  <div class="select-wrap">
    <select class="dropdown" data-role="single"></select>
  </div>
</div>

<div class="celeb-grid"></div>

<div class="drop-zones">
  <div class="zone" data-zone="Kiss"><h3>üíã Kiss</h3></div>
  <div class="zone" data-zone="Marry"><h3>üíç Marry</h3></div>
  <div class="zone" data-zone="Kill"><h3>‚ò†Ô∏è Kill</h3></div>
</div>

<script src="default.js"></script>

<script>
/* =========================
   GAME STATE
========================= */

const celebGrid = document.querySelector(".celeb-grid");
const zones = document.querySelectorAll(".zone");

let celebNames = [];
let currentIndex = 0;
let currentSet = [];
let results = [];
let currentChoices = { Kiss:null, Marry:null, Kill:null };

let draggedCard = null;

/* =========================
   GAME START
========================= */

loadPeopleData(() => {
  startGame();
});

/* =========================
   START / RESET GAME
========================= */

function startGame(){
  const data = getPeople(gender);

  celebNames = shuffle(Object.keys(data));
  currentIndex = 0;
  results = [];

  nextRound();
}

/* =========================
   GAME ROUND
========================= */

function nextRound(){
  if (currentIndex + 3 > celebNames.length) {
    endGame();
    return;
  }

  currentSet = celebNames.slice(currentIndex, currentIndex + 3);
  currentIndex += 3;

  currentChoices = { Kiss:null, Marry:null, Kill:null };

  celebGrid.innerHTML = "";
  zones.forEach(zone => {
    zone.classList.remove("filled");
    zone.querySelectorAll(".card").forEach(c => c.remove());
  });

  currentSet.forEach(name => {
    celebGrid.appendChild(createCard(name));
  });
}

/* =========================
   CARD CREATION
========================= */

function createCard(name){
  const div = document.createElement("div");
  div.className = "card hoverable";
  div.draggable = true;
  div.dataset.name = name;

  const img = getPeople(gender)[name];

  div.innerHTML = `
    ${img ? `<img src="${img}" draggable="false">` : ""}
    <p>${name}</p>
  `;

  div.addEventListener("dragstart", e => {
    draggedCard = div;
    e.dataTransfer.setData("text/plain", "");
  });

  return div;
}

/* =========================
   DRAG & DROP
========================= */

function allowDrop(e){
  e.preventDefault();
}

function dropToZone(e, zone){
  e.preventDefault();
  if (!draggedCard) return;

  removeFromAllSlots(draggedCard.dataset.name);

  const key = zone.dataset.zone;
  currentChoices[key] = draggedCard.dataset.name;

  zone.classList.add("filled");
  draggedCard.classList.add("in-slot");
  zone.appendChild(draggedCard);

  draggedCard = null;

  if (Object.values(currentChoices).every(Boolean)) {
    results.push({ ...currentChoices });
    setTimeout(nextRound, 900);
  }
}

function dropToPool(e){
  e.preventDefault();
  if (!draggedCard) return;

  removeFromAllSlots(draggedCard.dataset.name);
  draggedCard.classList.remove("in-slot");
  celebGrid.appendChild(draggedCard);
  draggedCard = null;
}

function removeFromAllSlots(name){
  for (const key in currentChoices) {
    if (currentChoices[key] === name) {
      currentChoices[key] = null;
      document.querySelector(`.zone[data-zone="${key}"]`)
        .classList.remove("filled");
    }
  }
}

/* =========================
   GAME END
========================= */

function endGame(){
  document.body.innerHTML = `
    <h2>Game Over</h2>
    ${results.map((r,i)=>`
      <p>Round ${i+1}: üíã ${r.Kiss}, üíç ${r.Marry}, ‚ò†Ô∏è ${r.Kill}</p>
    `).join("")}
    <br>
    <a href="kmk.html">Play Again</a>
  `;
}

/* =========================
   EVENTS
========================= */

zones.forEach(zone => {
  zone.addEventListener("dragover", allowDrop);
  zone.addEventListener("drop", e => dropToZone(e, zone));
});

celebGrid.addEventListener("dragover", allowDrop);
celebGrid.addEventListener("drop", dropToPool);

/* =========================
   UTIL
========================= */

function shuffle(arr){
  for (let i = arr.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
</script>

</body>
</html>

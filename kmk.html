<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kiss Marry Kill</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" href="default.css">
  <style>
    .celeb-grid{
      display:flex;
      justify-content:center;
      gap:24px;
      margin:30px 0;
      flex-wrap:wrap;
      min-height:300px;
    }

    .drop-zones{
      display:flex;
      justify-content:center;
      gap:24px;
      margin-top:40px;
      flex-wrap:wrap;
    }

    .zone{
      width:220px;
      height:340px;
      border:2px dashed #555;
      border-radius:12px;
      padding:10px;
      background:#1a1a1a;
      display:flex;
      flex-direction:column;
      align-items:center;
      transition:.2s;
    }

    .zone h3{
      margin:5px 0 10px;
    }

    .zone.filled{
      border-color:#3cff9a;
      transform:scale(1.03);
    }


    .in-slot{
      cursor:grab;
      border-color:#3cff9a;
    }

    .in-slot:hover{
      transform:none;
    }

  </style>
</head>
<body>
<div id="helpWrapper">
  <button id="helpBtn">?</button>
  <div id="helpTooltip">
    <strong>How to Play</strong><br><br>
    ‚Ä¢ Each round, you will be shown three people<br>
    ‚Ä¢ Each person should be dragged and dropped into the slot you want<br>
    ‚Ä¢ Once each slot is filled it will move to the next round<br><br>
    <strong>Note</strong><br>
    You can drag a person back to the pool or a new slot to change your choice

  </div>
</div>
<h1>Kiss Marry Kill</h1>

<a href="index.html">Smash or Pass</a>
<a href="kmk.html">Kiss Marry Kill</a>
<a href="goc.html">Girl or Car</a>
<a href="blind.html">Blind Ranking</a>
<a href="wyw.html">King of the Hill</a>
<a href="chaos.html">Infinity War</a>
<a href="fb.html">Football Lineup</a>
<a href="draft.html">Roster</a>

<br><br>

<div class="mode-toggle">
  <button id="femaleBtn">‚ôÄ Female</button>
  <button id="maleBtn">‚ôÇ Male</button>
</div>

<div class="celeb-grid" id="celebGrid"></div>

<div class="drop-zones">
  <div class="zone" id="Kiss"><h3>üíã Kiss</h3></div>
  <div class="zone" id="Marry"><h3>üíç Marry</h3></div>
  <div class="zone" id="Kill"><h3>‚ò†Ô∏è Kill</h3></div>
</div>

<script src="default.js"></script>

<script>
let celebGrid = document.getElementById("celebGrid");
let zones = ["Kiss","Marry","Kill"].map(id => document.getElementById(id));

let celebNames = [];
let currentIndex = 0;
let currentSet = [];
let results = [];
let currentChoices = { Kiss:null, Marry:null, Kill:null };

let draggedCard = null;

function startGame(){
  const data = getPeopleByGender();
  celebNames = shuffle(Object.keys(data));
  currentIndex = 0;
  results = [];
  nextRound();
  updateGenderButtons();
}

function nextRound(){
  if(currentIndex + 3 > celebNames.length){
    endGame();
    return;
  }

  currentSet = celebNames.slice(currentIndex, currentIndex + 3);
  currentIndex += 3;

  currentChoices = { Kiss:null, Marry:null, Kill:null };

  celebGrid.innerHTML = "";
  zones.forEach(z => {
    z.classList.remove("filled");
    [...z.querySelectorAll(".card")].forEach(c => c.remove());
  });

  currentSet.forEach(name => {
    celebGrid.appendChild(createCard(name));
  });
}

function createCard(name){
  const div = document.createElement("div");
  div.className = "card hoverable";
  div.draggable = true;
  div.dataset.name = name;

  const img = getPeopleByGender()[name];
  div.innerHTML = `
    ${img ? `<img src="${img}" draggable="false">` : ""}
    <p>${name}</p>
  `;

  div.addEventListener("dragstart", e => {
    draggedCard = div;
    e.dataTransfer.setData("text/plain", "");
  });

  return div;
}

function allowDrop(e){ e.preventDefault(); }

function drop(e, cat){
  e.preventDefault();
  if(!draggedCard) return;

  removeFromAllSlots(draggedCard.dataset.name);

  currentChoices[cat] = draggedCard.dataset.name;

  const zone = document.getElementById(cat);
  zone.classList.add("filled");
  draggedCard.classList.add("in-slot");
  zone.appendChild(draggedCard);

  draggedCard = null;

  if(Object.values(currentChoices).every(Boolean)){
    results.push({ ...currentChoices });
    setTimeout(nextRound, 900);
  }
}

function dropToPool(e){
  e.preventDefault();
  if(!draggedCard) return;

  removeFromAllSlots(draggedCard.dataset.name);
  draggedCard.classList.remove("in-slot");
  celebGrid.appendChild(draggedCard);

  draggedCard = null;
}

function removeFromAllSlots(name){
  for(const key in currentChoices){
    if(currentChoices[key] === name){
      currentChoices[key] = null;
      document.getElementById(key).classList.remove("filled");
    }
  }
}

function endGame(){
  document.body.innerHTML = `
    <h2>Game Over</h2>
    ${results.map((r,i)=>`
      <p>Round ${i+1}: üíã ${r.Kiss}, üíç ${r.Marry}, ‚ò†Ô∏è ${r.Kill}</p>
    `).join("")}
    <br>
    <a href="kmk.html">Play Again</a>
  `;
}

zones.forEach(z=>{
  z.addEventListener("dragover", allowDrop);
  z.addEventListener("drop", e => drop(e, z.id));
});

celebGrid.addEventListener("dragover", allowDrop);
celebGrid.addEventListener("drop", dropToPool);

loadPeopleData(startGame);

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
</script>
<script src="mobile.js"></script>

</body>
</html>

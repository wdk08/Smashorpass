<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>King of the Hill</title>

  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" href="default.css">

  <style>
    .choices{
      display:flex;
      justify-content:center;
      gap:50px;
      margin-top:40px;
      flex-wrap:wrap;
    }

    .winner{
      margin-top:30px;
    }

    .winner img{
      width:320px;
      border-radius:14px;
      background:#000;
    }
  </style>
</head>

<body>

<div id="helpWrapper">
  <button id="helpBtn">?</button>
  <div id="helpTooltip">
    <strong>How to Play</strong><br><br>
    ‚Ä¢ Choose who stays on the hill<br>
    ‚Ä¢ The loser is eliminated<br>
    ‚Ä¢ A new challenger appears each round<br>
    ‚Ä¢ Last one standing wins
  </div>
</div>

<h1>King of the Hill</h1>

<div class="navLinks"></div>
<br><br>

<div class="mode-toggle">
  <div class="select-wrap">
    <select class="dropdown" data-role="single"></select>
  </div>
</div>

<div class="choices"></div>

<script src="default.js"></script>

<script>
/* =========================
   GAME STATE
========================= */

const choicesDiv = document.querySelector(".choices");

let pool = [];
let eliminated = [];
let currentChampion = null;
let challenger = null;

/* =========================
   GAME START
========================= */

loadPeopleData(() => {
  startGame();
});

/* =========================
   START / RESET GAME
========================= */

function startGame(){
  const data = getPeople(gender);
  const entries = Object.entries(data);

  if (!entries.length) {
    choicesDiv.innerHTML = "<p>No data available</p>";
    return;
  }

  pool = shuffle(
    entries.map(([name, img]) => ({ name, img }))
  );

  eliminated = [];
  currentChampion = pool.shift();
  challenger = pool.shift();

  renderChoices();
}

/* =========================
   RENDER
========================= */

function renderChoices(){
  choicesDiv.innerHTML = "";

  if (!currentChampion) return;

  if (!challenger) {
    showWinner();
    return;
  }

  [currentChampion, challenger].forEach((item, index) => {
    const card = document.createElement("div");
    card.className = "card hoverable";

    card.innerHTML = `
      ${item.img ? `<img src="${item.img}" draggable="false">` : ""}
      <p>${item.name}</p>
    `;

    card.onclick = () => choose(index);
    choicesDiv.appendChild(card);
  });
}

/* =========================
   GAME LOGIC
========================= */

function choose(index){
  const winner = index === 0 ? currentChampion : challenger;
  const loser  = index === 0 ? challenger : currentChampion;

  eliminated.push(loser);
  currentChampion = winner;

  if (pool.length === 0) {
    showWinner();
    return;
  }

  challenger = pool.shift();
  renderChoices();
}

/* =========================
   END
========================= */

function showWinner(){
  choicesDiv.innerHTML = `
    <div class="winner">
      <h2>Winner üèÜ</h2>
      ${currentChampion.img ? `<img src="${currentChampion.img}">` : ""}
      <h3>${currentChampion.name}</h3>
      <p>Defeated ${eliminated.length} others</p>
    </div>
  `;
}

/* =========================
   UTIL
========================= */

function shuffle(arr){
  for (let i = arr.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
</script>

<script src="mobile.js"></script>

</body>
</html>

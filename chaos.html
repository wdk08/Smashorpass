<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Balance of the Gauntlet</title>
  <link rel="stylesheet" href="default.css">
  <style>


    /* ---------------- CARDS ---------------- */
    #game {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 30px;
    }

    .stones {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 20px 0;
    }

    .stone-btn {
      padding: 10px 14px;
      border-radius: 8px;
      border: 2px solid #444;
      background: #1a1a1a;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }

    .stone-btn:hover {
      border-color: #0af;
    }

    /* ---------------- LISTS ---------------- */
    #lists {
      display: flex;
      justify-content: space-between;
      max-width: 900px;
      margin: 20px auto;
      gap: 20px;
    }

    .list {
      width: 45%;
      background: #1a1a1a;
      border: 2px solid #333;
      border-radius: 12px;
      padding: 10px;
      max-height: 300px;
      overflow-y: auto;
    }

    .list ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .list li {
      padding: 4px 0;
      border-bottom: 1px solid #222;
      cursor: pointer;
    }

    .list li.protected::after {
      content: " ğŸ›¡ï¸";
    }

    .list li.temp::after {
      content: " ğŸ›¡ï¸";
      opacity: .6;
    }

    .list li.highlight {
      background: #0af22f;
    }
  </style>
</head>
<body>
<div id="helpWrapper">
  <button id="helpBtn">?</button>
  <div id="helpTooltip">
    <strong>How to Play</strong><br><br>
    â€¢ Pick one card each round<br>
    â€¢ Who you choose goes to <b>Keep</b>, others go to <b>Gone</b><br>
    â€¢ Max 15 in Keep â€” oldest gets removed<br><br>
    <b>Stones:</b><br>
    â³ Time: Undo last snap<br>
    ğŸŒŒ Space: Protect one player (1 snap)<br>
    ğŸ’€ Soul: Sacrifice one, restore one<br>
    ğŸª Reality: Restore from Gone
  </div>
</div>
<h1>Balance of the Gauntlet</h1>

<a href="index.html">Smash or Pass</a>
<a href="kmk.html">Kiss Marry Kill</a>
<a href="goc.html">Girl or Car</a>
<a href="blind.html">Blind Ranking</a>
<a href="wyw.html">King of the Hill</a>
<a href="chaos.html">Infinity War</a>
<a href="fb.html">Football Lineup</a>
<a href="draft.html">Roster</a>

<br><br>

<div class="mode-toggle">
  <button id="femaleBtn" onclick="switchGender('Female')">â™€ Female</button>
  <button id="maleBtn" onclick="switchGender('Male')">â™‚ Male</button>
</div>

<!-- STONES -->
<div class="stones">
  <button class="stone-btn" style="background-color:#00ff00" id="time">â³ Time</button>
  <button class="stone-btn" style="background-color:#ff9900" id="soul">ğŸ’€ Soul</button>
  <button class="stone-btn" style="background-color:#0000ff" id="space">ğŸŒŒ Space</button>
  <button class="stone-btn" style="background-color:#ff0000" id="reality">ğŸª Reality</button>
</div>



<!-- LISTS -->
<div id="lists">
  <div class="list">
    <h3>âœ… Keep</h3>
    <ul id="keepList"></ul>
  </div>
  <div class="list">
    <h3>âŒ Gone</h3>
    <ul id="goneList"></ul>
  </div>
</div>

<!-- GAME -->
<div id="game">
  <div class="card" id="CardA">
  <img id="imgA" src="" alt="" draggable="false">
  <p id="nameA">Loading...</p>
</div>
<div class="card" id="CardB">
  <img id="imgB" src="" alt="" draggable="false">
  <p id="nameB">Loading...</p>
</div>
</div>

<script src="default.js"></script>
<script>
let stones = { time:false, soul:false, space:false, reality:false };
let pool = [], keep = [], gone = [], pair = [];
let stoneMode = null;
let lastSnap = [];

const time = document.getElementById("time");
const soul = document.getElementById("soul");
const space = document.getElementById("space");
const reality = document.getElementById("reality");

const MAX_KEEP = 15;
const SNAP_CHANCE = 0.25;

time.onclick = () => {
  if(stones.time) return alert("â³ Time Stone already used");
  stones.time = true;

  const restore = gone.filter(p => lastSnapIds.includes(p.id));
  gone = gone.filter(p => !lastSnapIds.includes(p.id));
  keep.push(...restore);

  lastSnapIds = [];
  render();
};

space.onclick = () => {
  if(stones.space) return alert("ğŸŒŒ Space Stone already used");
  stones.space = true;
  stoneMode = "space";
  highlightKeep();
};

soul.onclick = () => {
  if(stones.soul) return alert("ğŸ’€ Soul Stone already used");
  stones.soul = true;
  stoneMode = "soul-sacrifice";
  alert("ğŸ’€ Choose ONE from Keep to sacrifice");
  highlightKeep();
};

reality.onclick = () => {
  if(stones.reality) return alert("ğŸª Reality Stone already used");
  stones.reality = true;
  stoneMode = "reality";
  alert("ğŸª Choose ONE from Gone to restore");
  highlightGone();
};

function startGame(){
  pool = shuffle(
    Object.entries(getPeopleByGender()).map(([name, img], id) => ({
      id, name, img
    }))
  );

  keep = [];
  gone = [];
  pair = [];
  lastSnap = [];

  next();
  render();
}

function highlightKeep(){
  clear(false); // pass false so stoneMode isn't reset

  document.querySelectorAll("#keepList li").forEach(li=>{
    li.classList.add("highlight");
    li.onclick = () => {
      const p = keep.find(x => x.id == li.dataset.id);

      if(stoneMode === "space"){
        p.temp = true;
        stoneMode = null;
        clear(false); // don't reset stoneMode

        render();
        return;
      }

      if(stoneMode === "soul-sacrifice"){
        keep = keep.filter(x => x.id !== p.id);
        gone.push(p);
        stoneMode = "soul-restore"; // next step: restore from gone
        clear(false); // don't reset stoneMode

        render();
        alert("ğŸ’€ Choose ONE from Gone to restore");
        highlightGone();
      }
    };
  });
}

function highlightGone(){
  clear(false);

  document.querySelectorAll("#goneList li").forEach(li=>{
    li.classList.add("highlight");
    li.onclick = () => {
      const i = gone.findIndex(x => x.id == li.dataset.id);
      keep.push(gone.splice(i,1)[0]);
      stoneMode = null;
      clear(false); // don't reset stoneMode

      render();
    };
  });
}

// allow optional param so we don't reset stoneMode
function clear(reset=true){
  document.querySelectorAll("li").forEach(li=>{
    li.classList.remove("highlight");
    li.onclick = null;
  });
  if(reset) stoneMode = null;
}


function clear(resetMode = false){
  document.querySelectorAll("li").forEach(li=>{
    li.classList.remove("highlight");
    li.onclick = null;
  });
  if(resetMode) stoneMode = null;
}

function next(){
  if(pool.length < 2) return end();

  pair = [pool.pop(), pool.pop()];
  nameA.textContent = pair[0].name;
  imgA.src = pair[0].img;
  nameB.textContent = pair[1].name;
  imgB.src = pair[1].img;
}

function choose(i){
  const win = pair[i];
  const lose = pair[1 - i];

  if(keep.length >= MAX_KEEP) gone.push(keep.shift());
  keep.push(win);
  gone.push(lose);

  if(Math.random() < SNAP_CHANCE) snap();

  render();
  next();
}

function snap(){
  const eligible = keep.filter(p => !p.protected && !p.temp); // protected people survive
  const count = Math.floor(eligible.length / 2);
  if(count === 0) return;

  shuffle(eligible);
  const victims = eligible.slice(0, count);
  lastSnapIds = victims.map(v => v.id);

  keep = keep.filter(p => !lastSnapIds.includes(p.id));
  gone.push(...victims);

  // reset temp after snap
  keep.forEach(p => p.temp = false);

  alert(`ğŸ’¥ SNAP! ${count} erased.`);
}



function render(){
  keepList.innerHTML = keep.map(p => {
    let cls = "";
    if(p.protected) cls = "protected";
    else if(p.temp) cls = "temp";
    return `<li class="${cls}" data-id="${p.id}">${p.name}</li>`;
  }).join("");

  goneList.innerHTML = gone.map(p => `<li data-id="${p.id}">${p.name}</li>`).join("");
}


function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function end(){
  document.body.innerHTML =
    "<h1>Game Over</h1>" +
    keep.map(p => `<p>${p.name}</p>`).join("");
}

loadPeopleData(startGame);
updateGenderButtons();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="mobile.css">

<meta charset="UTF-8">
<title>Balance of the Gauntlet</title>
<link rel="icon" type="image/png" href="favicon.png">
<link rel="stylesheet" href="default.css">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon.png">
    <meta name="apple-mobile-web-app-title" content="Blue Flash">

<style>
#game{
  display:flex;
  justify-content:center;
  gap:30px;
  margin-top:30px
}
.stones{
  display:flex;
  justify-content:center;
  gap:12px;
  margin:20px 0
}
.stone-btn{
  padding:10px 14px;
  border-radius:8px;
  border:2px solid #444;
  color:#fff;
  font-weight:bold;
  cursor:pointer
}
#time{background:#00ff00}
#soul{background:#ff9900}
#space{background:#0000ff}
#reality{background:#ff0000}
.card:hover{cursor:pointer}
#lists{
  display:flex;
  justify-content:space-between;
  max-width:900px;
  margin:20px auto;
  gap:20px
}
.list{
  width:45%;
  background:#1a1a1a;
  border:2px solid #333;
  border-radius:12px;
  padding:10px;
  max-height:300px;
  overflow-y:auto
}
.list ul{list-style:none;padding:0;margin:0}
.list li{
  padding:4px 0;
  border-bottom:1px solid #222;
  cursor:pointer
}
.list li.protected::after{content:" ğŸ›¡ï¸"}
.list li.temp::after{content:" ğŸ›¡ï¸";opacity:.6}
.list li.highlight{background:#0af22f}
</style>
</head>
<body>

<div id="helpWrapper">
<button id="helpBtn">?</button>
<div id="helpTooltip">
<strong>How to Play</strong><br><br>
â€¢ Pick one card each round<br>
â€¢ Who you choose goes to <b>Keep</b>, others go to <b>Gone</b><br>
â€¢ Max 15 in Keep â€” oldest gets removed<br><br>
<b>Stones:</b><br>
â³ Time: Undo last snap<br>
ğŸŒŒ Space: Protect one player (1 snap)<br>
ğŸ’€ Soul: Sacrifice one, restore one<br>
ğŸª Reality: Restore from Gone
</div>
</div>

<h1>Balance of the Gauntlet</h1>
<div class="navLinks"></div>
<br><br>

<div class="mode-toggle">
  <div class="select-wrap">
    <select class="dropdown" data-role="left"></select>
  </div>
  <div class="select-wrap">
    <select class="dropdown" data-role="right"></select>
  </div>
</div>


<div class="stones">
<button class="stone-btn" id="time">â³ Time</button>
<button class="stone-btn" id="soul">ğŸ’€ Soul</button>
<button class="stone-btn" id="space">ğŸŒŒ Space</button>
<button class="stone-btn" id="reality">ğŸª Reality</button>
</div>

<div id="lists">
<div class="list">
<h3>âœ… Keep</h3>
<ul id="keepList"></ul>
</div>
<div class="list">
<h3>âŒ Gone</h3>
<ul id="goneList"></ul>
</div>
</div>

<div id="game">
<div class="card" id="CardA">
<img id="imgA" draggable="false">
<p id="nameA">Loading...</p>
</div>
<div class="card" id="CardB">
<img id="imgB" draggable="false">
<p id="nameB">Loading...</p>
</div>
</div>

<script src="default.js"></script>
<script>
const MAX_KEEP=15
const SNAP_CHANCE=0.30

const CardA=document.getElementById("CardA")
const CardB=document.getElementById("CardB")
const imgA=document.getElementById("imgA")
const imgB=document.getElementById("imgB")
const nameA=document.getElementById("nameA")
const nameB=document.getElementById("nameB")
const keepList=document.getElementById("keepList")
const goneList=document.getElementById("goneList")

const timeBtn=document.getElementById("time")
const soulBtn=document.getElementById("soul")
const spaceBtn=document.getElementById("space")
const realityBtn=document.getElementById("reality")

let stones={time:false,soul:false,space:false,reality:false}
let pool=[]
let keep=[]
let gone=[]
let pair=[]
let stoneMode=null
let lastSnapIds=[]

timeBtn.onclick=()=>{
  if(stones.time)return alert("â³ Time Stone already used")
  stones.time=true
  const restore=gone.filter(p=>lastSnapIds.includes(p.id))
  gone=gone.filter(p=>!lastSnapIds.includes(p.id))
  keep.push(...restore)
  lastSnapIds=[]
  render()
}

spaceBtn.onclick=()=>{
  if(stones.space)return alert("ğŸŒŒ Space Stone already used")
  stones.space=true
  stoneMode="space"
  highlightKeep()
}

soulBtn.onclick=()=>{
  if(stones.soul)return alert("ğŸ’€ Soul Stone already used")
  stones.soul=true
  stoneMode="soul-sacrifice"
  alert("ğŸ’€ Choose ONE from Keep to sacrifice")
  highlightKeep()
}

realityBtn.onclick=()=>{
  if(stones.reality)return alert("ğŸª Reality Stone already used")
  stones.reality=true
  stoneMode="reality"
  alert("ğŸª Choose ONE from Gone to restore")
  highlightGone()
}

function startGame(){
  leftPool = shuffle(
    Object.entries(getPeople(leftCategory))
      .map(([name, img], id) => ({ id: `L-${id}`, name, img }))
  );

  rightPool = shuffle(
    Object.entries(getPeople(rightCategory))
      .map(([name, img], id) => ({ id: `R-${id}`, name, img }))
  );

  keep = [];
  gone = [];
  pair = [];
  lastSnapIds = [];

  next();
  render();
}


function clearHandlers(reset=true){
  document.querySelectorAll("li").forEach(li=>{
    li.classList.remove("highlight")
    li.onclick=null
  })
  if(reset)stoneMode=null
}

function highlightKeep(){
  clearHandlers(false)
  document.querySelectorAll("#keepList li").forEach(li=>{
    li.classList.add("highlight")
    li.onclick=()=>{
      const p=keep.find(x=>x.id==li.dataset.id)
      if(stoneMode==="space"){
        p.temp=true
        stoneMode=null
        clearHandlers(false)
        render()
        return
      }
      if(stoneMode==="soul-sacrifice"){
        keep=keep.filter(x=>x.id!==p.id)
        gone.push(p)
        stoneMode="soul-restore"
        clearHandlers(false)
        render()
        alert("ğŸ’€ Choose ONE from Gone to restore")
        highlightGone()
      }
    }
  })
}

function highlightGone(){
  clearHandlers(false)
  document.querySelectorAll("#goneList li").forEach(li=>{
    li.classList.add("highlight")
    li.onclick=()=>{
      const i=gone.findIndex(x=>x.id==li.dataset.id)
      keep.push(gone.splice(i,1)[0])
      stoneMode=null
      clearHandlers(false)
      render()
    }
  })
}

function next(){
  if(!leftPool.length || !rightPool.length) return end();

  pair = [
    leftPool.pop(),
    rightPool.pop()
  ];

  nameA.textContent = pair[0].name;
  imgA.src = pair[0].img;

  nameB.textContent = pair[1].name;
  imgB.src = pair[1].img;
}


function choose(i){
  const win=pair[i]
  const lose=pair[1-i]
  if(keep.length>=MAX_KEEP)gone.push(keep.shift())
  keep.push(win)
  gone.push(lose)
  if(Math.random()<SNAP_CHANCE)snap()
  render()
  next()
}

function snap(){
  const eligible=keep.filter(p=>!p.protected&&!p.temp)
  const count=Math.floor(eligible.length/2)
  if(!count)return
  shuffle(eligible)
  const victims=eligible.slice(0,count)
  lastSnapIds=victims.map(v=>v.id)
  keep=keep.filter(p=>!lastSnapIds.includes(p.id))
  gone.push(...victims)
  keep.forEach(p=>p.temp=false)
  alert(`ğŸ’¥ SNAP! ${count} erased.`)
}

function render(){
  keepList.innerHTML=keep.map(p=>{
    let cls=""
    if(p.protected)cls="protected"
    else if(p.temp)cls="temp"
    return `<li class="${cls}" data-id="${p.id}">${p.name}</li>`
  }).join("")
  goneList.innerHTML=gone.map(p=>`<li data-id="${p.id}">${p.name}</li>`).join("")
}

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1))
    ;[a[i],a[j]]=[a[j],a[i]]
  }
  return a
}

function end(){
  document.body.innerHTML="<h1>Game Over</h1>"+keep.map(p=>`<p>${p.name}</p>`).join("")
}

CardA.onclick=()=>{if(!stoneMode)choose(0)}
CardB.onclick=()=>{if(!stoneMode)choose(1)}

loadPeopleData(startGame)
</script>
</body>
</html>

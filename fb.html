<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Build the Lineup</title>
<link rel="icon" type="image/png" href="favicon.png">
<link rel="stylesheet" href="default.css">

<style>
/* ================= FIELD ================= */
.field {
  max-width: 900px;
  margin: 40px auto;
  background: linear-gradient(#0b6623, #064e1a);
  border-radius: 18px;
  padding: 30px;
  border: 3px solid #333;
}

.field-grid {
  display: grid;
  grid-template-columns: repeat(11, 1fr);
  grid-template-rows: repeat(3, 90px);
  gap: 14px;
}

/* ================= SLOTS ================= */
.slot {
  width: 65px;
  height: 90px;
  border-radius: 10px;
  background: #1c1c1c;
  border: 2px dashed rgba(255,255,255,0.35);
  display: flex;
  flex-direction: column;
  justify-content: center;
  text-align: center;
  opacity: 0.45;
  transition: 0.2s;
  overflow: hidden;
}

.slot.hover {
  border-color: #0af;
  box-shadow: 0 0 15px rgba(0,170,255,0.6);
}

.slot.filled {
  border-style: solid;
  opacity: 1;
  cursor: grab;
}

.slot img {
  width: 100%;
  height: 58%;
  object-fit: cover;
}

.slot .slot-name {
  font-size: 0.5rem;
  padding: 2px;
  line-height: 1.05;
}

.slot small {
  font-size: 0.4rem;
  opacity: 0.6;
  letter-spacing: 0.7px;
}

</style>
</head>

<body>
<div id="helpWrapper">
  <button id="helpBtn">?</button>
  <div id="helpTooltip">
    <strong>How to Play</strong><br><br>
    ‚Ä¢ Each round, you will be shown one person to use<br>
    ‚Ä¢ Drag and drop the person to the position you want them to be at<br>
    ‚Ä¢ New people will show up until the roster is full<br><br>
    <strong>Note</strong><br>
    People can be moved to different slots after being placed by dragging them again
  </div>
</div>
<h1>Build the Lineup</h1>

<a href="index.html">Smash or Pass</a>
<a href="kmk.html">Kiss Marry Kill</a>
<a href="goc.html">Girl or Car</a>
<a href="blind.html">Blind Ranking</a>
<a href="wyw.html">King of the Hill</a>
<a href="chaos.html">Infinity War</a>
<a href="fb.html">Football Lineup</a>
<a href="draft.html">Roster</a>

<br><br>

<div class="mode-toggle">
  <button id="femaleBtn">‚ôÄ Female</button>
  <button id="maleBtn">‚ôÇ Male</button>
</div>

<!-- CARD SPAWNS HERE -->
<div id="cardMount"></div>

<!-- FIELD -->
<div class="field">
  <div class="field-grid">

    <!-- Row 1 -->
    <div class="slot" data-pos="WR1" style="grid-column:1;">WR1</div>
    <div class="slot" data-pos="FLEX" style="grid-column:3;">FLEX</div>

    <div class="slot" data-pos="LT" style="grid-column:5;">LT</div>
    <div class="slot" data-pos="LG" style="grid-column:6;">LG</div>
    <div class="slot" data-pos="C"  style="grid-column:7;">C</div>
    <div class="slot" data-pos="RG" style="grid-column:8;">RG</div>
    <div class="slot" data-pos="RT" style="grid-column:9;">RT</div>

    <div class="slot" data-pos="TE" style="grid-column:10;">TE</div>
    <div class="slot" data-pos="WR2" style="grid-column:11;">WR2</div>

    <!-- Row 2 -->
    <div class="slot" data-pos="QB" style="grid-column:7; grid-row:2;">QB</div>

    <!-- Row 3 -->
    <div class="slot" data-pos="RB" style="grid-column:7; grid-row:3;">RB</div>

  </div>
</div>

<script src="default.js"></script>
<script>
/* ================= GAME STATE ================= */
let pool = [];
let current = null;
let activeCard = null;
let filledCount = 0;

const MAX_PLAYERS = 11;
const cardMount = document.getElementById("cardMount");

/* ================= START GAME ================= */
function startGame(){
  pool = Object.entries(getPeopleByGender())
    .map(([name, img]) => ({ name, img }))
    .sort(() => Math.random() - 0.5);

  filledCount = 0;
  cardMount.innerHTML = "";
  document.querySelectorAll(".slot").forEach(s=>{
    s.classList.remove("filled");
    s.innerHTML = s.dataset.pos;
    s.draggable = false;
  });

  spawnNextCard();
}

/* ================= CARD ================= */
function createCard(player){
  const card = document.createElement("div");
  card.className = "card center";
  card.draggable = true;

  const img = document.createElement("img");
  img.src = player.img || "";

  const name = document.createElement("p");
  name.textContent = player.name;

  card.append(img, name);

  card.addEventListener("dragstart", ()=>{
    activeCard = card;
  });

  return card;
}

function spawnNextCard(){
  if(filledCount >= MAX_PLAYERS || pool.length === 0){
    endGame();
    return;
  }

  current = pool.pop();

  if(activeCard) activeCard.remove();

  activeCard = createCard(current);
  cardMount.appendChild(activeCard);
}

/* ================= SLOTS ================= */
document.querySelectorAll(".slot").forEach(slot=>{
  slot.addEventListener("dragover", e=>{
    if(slot.classList.contains("filled")) return;
    e.preventDefault();
    slot.classList.add("hover");
  });

  slot.addEventListener("dragleave", ()=>{
    slot.classList.remove("hover");
  });

  slot.addEventListener("drop", e=>{
    e.preventDefault();
    slot.classList.remove("hover");

    if(slot.classList.contains("filled")) return;

    fillSlot(slot, current);
    filledCount++;

    activeCard.remove();
    activeCard = null;

    spawnNextCard();
  });
});

/* ================= SLOT FILL ================= */
function fillSlot(slot, player){
  slot.classList.add("filled");
  slot.innerHTML = `
    <img src="${player.img}" alt="${player.name}">
    <div class="slot-name">
      <small>${slot.dataset.pos}</small><br>
      ${player.name}
    </div>
  `;
}

/* ================= END ================= */
function endGame(){
  cardMount.innerHTML = "<h2>üèà Lineup Complete!</h2>";
}

/* ================= INIT ================= */
loadPeopleData(startGame);
updateGenderButtons();
</script>

</body>
</html>
